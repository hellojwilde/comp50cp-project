<!DOCTYPE html>
<html lang="en">
<head>
  <title>Registration Result</title>
</head>
<body>
  <h1>Registration Result</h1>
  <erl>
    send_registration(RegistrarPid, Name) ->
      RegistrarPid ! {register, self(), Name},
      receive
        {failure, registered, From} ->
          {ehtml, {h2, [], ["Registrar failed to register you."]}};
        {success, {Credential, BoothPid}, _RegistrarPid} ->
          {ehtml, {h2, [], [
            "Success: go vote at booth ", 
            pid_to_list(BoothPid),
            " with credential ",
            Credential
          ]}}
      after
        2000 ->
          {ehtml, {h2, [], ["Timeout waiting for registrar."]}}
      end.

    out(A) ->
      case {postvar(A, "registrar"), postvar(A, "name")} of
        {{ok, RegistrarVal}, {ok, NameVal}} -> 
          send_registration(list_to_pid(RegistrarVal), NameVal);
        _ ->
          {ehtml, {h2, [], ["Invalid registrar and/or name."]}}
      end.
  </erl>
</body>
</html>